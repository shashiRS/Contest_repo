"""
    Copyright 2022 Continental Corporation

    :file: swt_sample_test.pytest
    :platform: Windows, Linux
    :synopsis:
        This file contains sample test(s) for the power supplies controlled via RPC (remote
        procedure call) using RPC based PSU utility.

    :author:
        - Ganga Prabhakar Guntamukkala <ganga.prabhakar.guntamukkala@continental-corporation.com>
"""


# standard Python import area


# ConTest or custom import area
# NOTE : ALWAYS IMPORT (contest_expects, contest_asserts, report and get_parameter) AS BELOW.
#        FOR PROPER DOCUMENTATION AND ERROR REPORTING
import time

from contest_verify.verify import contest_asserts
from ptf.ptf_utils.report import DETAILS, PRECONDITION, VERIFIES, TESTTAG, TESTSTEP, EXPECTED, TESTCASE
from ptf.ptf_utils.global_params import get_parameter


def SWT_PSU_READ_VALUESv1():
    DETAILS("Demo test to show how to read values (V/I) from PSU via RPC")
    PRECONDITION("Ensure the power supply interface connected properly and "
                 "power-supply-controller.exe is running on the host machine")

    VERIFIES("get_voltage")
    VERIFIES("get_Current")

    TESTTAG("hil")

    TESTCASE()

    TESTSTEP("Grabbing PSU variable created in global setup")
    EXPECTED("Variables grabbed")
    psu_rpc = get_parameter("psu_rpc")

    TESTSTEP("Getting PSU output status")
    EXPECTED("PSU Output status received")
    print(psu_rpc.get_output())

    TESTSTEP("Reading output voltage from PSU")
    EXPECTED("Voltage read successfully")
    output_voltage = psu_rpc.get_voltage()
    print('Output voltage = ' + str(output_voltage) + ' V')

    TESTSTEP("Reading output current from PSU")
    EXPECTED("Current read successfully")
    output_current = psu_rpc.get_current()
    print('Output current = ' + str(output_current) + ' A')


def SWT_PSU_SET_GET_CURRENTv1():
    DETAILS("Demo test to show how to set and get Current of PSU via RPC")
    PRECONDITION("Ensure the power supply interface connected properly and "
                 "power-supply-controller.exe is running on the host machine")

    VERIFIES("set_current")

    TESTTAG("hil")

    TESTCASE()

    TESTSTEP("Grabbing PSU variable created in global setup")
    EXPECTED("Variables grabbed")
    psu_rpc = get_parameter("psu_rpc")

    # to set current
    current = 4.0

    TESTSTEP("Setting Current of PSU to 4 Amps")
    EXPECTED("Current set successfully")
    psu_rpc.set_current(current)

    # Waiting for 3 secs before reading the set current
    time.sleep(3)

    TESTSTEP("Reading the Current from PSU")
    EXPECTED("Current read successfully")
    read_current_1 = psu_rpc.get_current()
    print('Output Current Read = ' + str(read_current_1) + ' A')

    # to set Current
    current = 2.5

    TESTSTEP("Changing Current of PSU to 2.5 Amps")
    EXPECTED("Current changed successfully")
    psu_rpc.set_current(current)

    # Waiting for 3 secs before reading the set voltage and current
    time.sleep(3)

    TESTSTEP("Reading the Current from PSU")
    EXPECTED("Current read successfully")
    read_current_1 = psu_rpc.get_current()
    print('Output Current Read = ' + str(read_current_1) + ' A')


def SWT_PSU_SET_GET_VOLTAGEv1():
    DETAILS("Demo test to show how to set Voltage of PSU via RPC")
    PRECONDITION("Ensure the power supply interface connected properly and "
                 "power-supply-controller.exe is running on the host machine")

    VERIFIES("set_voltage")

    TESTTAG("hil")

    TESTCASE()

    TESTSTEP("Grabbing PSU variable created in global setup")
    EXPECTED("Variables grabbed")
    psu_rpc = get_parameter("psu_rpc")

    # to set voltage
    voltage = 6.0

    TESTSTEP("Setting output voltage of PSU to 6 Volts")
    EXPECTED("Voltage set successfully")
    psu_rpc.set_voltage(voltage)

    # Waiting for 3 secs before reading the set voltage and current
    time.sleep(3)

    TESTSTEP("Reading output voltage from PSU")
    EXPECTED("Voltage read successfully")
    read_voltage_1 = psu_rpc.get_voltage()
    print('Output voltage = ' + str(read_voltage_1) + ' V')

    # to set voltage
    voltage = 12.0

    TESTSTEP("Changing output voltage of PSU to 12 Volts")
    EXPECTED("Voltage changed successfully")
    psu_rpc.set_voltage(voltage)

    # Waiting for 3 secs before reading the set voltage and current
    time.sleep(3)

    TESTSTEP("Reading output voltage from PSU")
    EXPECTED("Voltage read successfully")
    read_voltage_2 = psu_rpc.get_voltage()
    print('Output voltage = ' + str(read_voltage_2) + ' V')
