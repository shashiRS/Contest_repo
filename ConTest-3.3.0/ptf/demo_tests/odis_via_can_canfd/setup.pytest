"""
    Copyright 2021 Continental Corporation

    This file contains up to four methods that will be called by the test framework:
        - global_setup(): Will be called before ALL test-cases
        - setup(): Will be called before EACH test-case
        - teardown(): Will be called after EACH test-case. Will also be called if test-case fails.
        - global_teardown(): Will be called after ALL test-cases.
                             Will be called if any execution before fails.

    :file: setup.pytest

    :author:
        - Ganga Prabhakar G <ganga.prabhakar.guntamukkala@continental-corporation.com>
"""


# standard Python import area

# ConTest or custom import area
# NOTE : ALWAYS IMPORT (contest_expects, contest_asserts and global_params) AS BELOW.
#        FOR PROPER ERROR REPORTING AND PARAMETER CONTROL
from ptf.ptf_utils.global_params import *
from ptf.tools_utils.odis import odis


def global_setup():
    """
    This method will be called before ALL test-cases are executed.

    You can set global variables with :func:`set_global_parameter`.
    Will skip execution of tests if this method fails.
    """
    # Creating an instance of ODIS tool
    odis_app = odis.Odis()
    # adding odis tool object into global parameter
    set_global_parameter("odis_tool", odis_app)
    # ODIS object is created with default exe path "C:\\Program Files\\
    # Offboard_Diagnostic_Information_System_Engineering\\OffboardDiagLauncher.exe"
    # if the path is different, please take care with start_odis API.
    # start_odis API will start new odis web instance with the provided exe and ini file.
    # odis_app.start_odis("path to OffboardDiagLauncher.exe", "path to ini file")
    odis_exe = "C:\\Program Files\\Offboard_Diagnostic_Information_System_Engineering\\" \
               "OffboardDiagLauncher.exe"
    odis_ini = "C:\\ProgramData\\Offboard_Diagnostic_Information_System_Engineering" \
               "\\configuration\\webservice.ini"
    # start_odis API establishes the ODIS web interface
    # API call with these arguments are intended for CAN/CANFD based connections.
    # If 'doip' argument is set to False, search for IP will not be done, which is not necessary for CAN/CANFD
    # connections
    # By default 'doip' argument is set to True.
    odis_app.start_odis(odis_exe_path=odis_exe, ini_file=odis_ini, doip=False)


def global_teardown():
    """
    This method will be called after ALL test-cases are executed.

    You can access global variables with :func:`get_parameter`.
    Guaranteed to be called, even if any test or global setup fails.
    """
    odis_obj = get_parameter('odis_tool')
    # Closing ODIS
    odis_obj.exit_odis()


def setup():
    """
    This method will be called before EACH test-case is executed.

    You can set local variables just available for the next test-case
    using :func:`set_local_parameter`.

    You can access global variables with :func:`get_parameter`.

    Will skip execution of test if this method fails.
    Skipped if global setup fails.
    """
    pass


def teardown():
    """
    This method will be called after EACH testcase is executed.

    You can access global variables with :func:`get_parameter`.

    Guaranteed to be called, even if the test or setup fails.
    Skipped if global setup fails.
    """
    pass
